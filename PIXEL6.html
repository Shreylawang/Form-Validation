<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <style>
        /* Chrome, Safari, Edge, Opera */
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        /* Firefox */
        input[type=number] {
            -moz-appearance: textfield;
        }
    </style>
</head>

<body>
    <form>
        <div id="firstPage" style="display: block;">
            <label for="name">FullName</label>
            <input type="text" id="name" />

            <label for="email">Email</label>
            <input type="text" id="email" />

            <label for="phone">Phone</label>
            <input type="number" id="phone" />

            <button id="submit">Submit</button>
            <!-- image and logo name to be displayed -->
            <img src="" alt="" id="image" width="50px" style="display: block;">
            <h5 id="logoName" style="display: block;"></h5>
            <!-- State to be displayed -->
            <h5 id="stateName"></h5>
            <!-- OTP to be displayed -->
            <h5 id="otp" style="color: firebrick;"></h5>
        </div>
    </form>
    <form>
        <div id="secondPage" style="display: none;">
            <h4>Dear <span id="nameDisplay"></span><br> Thank You for enquiry <br>A 4 digit no. has been sent to <span
                    id="phDisplay"></span>
            </h4>
            <h4>Please Verify Your otp</h4>
            <label for="otpVerify">Enter OTP</label>
            <input type="text" id="otpVerifyInput">
            <button id="verifyBtn">Verify</button>
        </div>
    </form>



    <script>
        // Code Starts Here :D

        //Extract all the DOM references into variable,
        const name = document.getElementById("name");
        const email = document.getElementById("email");
        const phone = document.getElementById("phone");
        const image = document.getElementById("image");
        const logoName = document.getElementById("logoName");
        const stateName = document.getElementById("stateName");
        const otp = document.getElementById('otp');
        const firstPage = document.getElementById('firstPage');
        const secondPage = document.getElementById('secondPage');
        const otpVerifyInput = document.getElementById('otpVerifyInput');
        const verifyBtn = document.getElementById('verifyBtn');
        const secondPageDiv = document.getElementById('secondPage');

        //Registering event listeners
        phone.addEventListener('keyup', validatePhone);
        //Setting up required Global Variables
        let isNameCheckedPassed = false;
        let isEmailCheckPassed = false;
        let isPhoneCheckPassed = false;
        let temp = "";
        let attempts = localStorage.getItem("otpAttempts");
        let nameDisplay = document.getElementById('nameDisplay');
        let phDisplay = document.getElementById('phDisplay');
        // Setting up name and images for network providers
        const providers = {
            jio: {
                name: "Realiance Jio",
                img: "https://cdn.iconscout.com/icon/free/png-256/jio-2363161-1970123.png",
            },
            vi: {
                name: "VI - Vodafone Idea",
                img: "https://upload.wikimedia.org/wikipedia/en/thumb/2/2a/VI_%28Vodafone_Idea%29_Logo.svg/1200px-VI_%28Vodafone_Idea%29_Logo.svg.png",
            },
            airtel: {
                name: "Airtel",
                img: "https://cdn.iconscout.com/icon/free/png-256/airtel-2709181-2249151.png",
            }
        };
        // Step 01 :- Check Name Validity
        function validateName() {
            //Setting up name validity
            isNameCheckedPassed = false;
            //Checking if length of name is not less than 8
            if (name.value.length < 8) {
                return alert("Please Enter FullName Atleast 8 digits");
            }
            //Spliting the firstname and lastname into two parts
            const words = name.value.split(" ");
            const firstName = words[0];
            nameDisplay = firstName;
            const lastName = words[1];
            console.log(firstName, lastName);
            // Checking that firstname and lastname is not less than 4 digits
            if (firstName.length < 4) {
                return alert("Please Enter FirstName Atleast 4 digits");
            }
            if (lastName.length < 4) {
                return alert("Please Enter LastName Atleast 4 digits");
            }
            //Confirming the validation to be satisfied
            isNameCheckedPassed = true;
            console.log(isNameCheckedPassed);
        }
        // Step 02 :- Check Email Validation
        function validateEmail() {
            //Setting up name validity
            isEmailCheckPassed = false;
            //Removing any blank spaces before or after the string
            let tempVar = email.value.trim();
            // Conditions
            // Must contain  "@" -> ✓
            // Must contain firstEmail before @ -> ✓
            // Must contain address after @ -> ✓
            // must contain . after address 
            // must contain domain (atleast 2 characters) after . -> ✓

            // Checking if contain  "@"
            if (tempVar.includes("@")) {
                //spliting values before and after "@" and storing into an array
                const tempEmail = tempVar.split("@");
                // Storing Values before "@" into firstname
                const firstName = tempEmail[0];
                // Storing Values after "@" into lastname
                const lastName = tempEmail[1];
                // Checking if firstname is blank
                if (firstName == "") {
                    return alert("Enter Email Address");
                }
                // Checking if lastname has '. (dot)' or not
                if (!tempEmail[1].includes(".")) {
                    return alert("Please provide a valid domain name");
                }
                // Spltiing values before and after "." of lastname and storing into an array
                const addressTemp = tempEmail[1].split(".");
                // Storing Values before "." into provider
                const provider = addressTemp[0];
                // Storing Values after "." into domain
                const domain = addressTemp[1];
                // Checking if lastname has domain name or not
                if (lastName == "") {
                    return alert("Enter Domain Name");
                }
                // Checking if lastname has provider name or not
                if (provider == "") {
                    return alert("Enter Provider Name");
                }
                // Checking if domain name is valid or not
                if (domain.length < 2) {
                    return alert("Enter Valid Domain Name");
                }
                console.log("all checks passed, email is valid");
                isEmailCheckPassed = true;
            } else {
                // invalid
                return alert("Invalid Email");
            }
        }


        // Step 03:- Check Phone Validation
        function validatePhone() {

            // Condition :-
            // Only Numbers are allowed -> ✓
            // Make the no. appear like 123-456-7890
            // No brackets, spcaes, hyphens -> ✓
            // REal-time updating while typing, not after pressing submit button -> ✓
            // First 3 -> (123) -> represents mobile -> provider print logo in the side
            // if first 3 -> 621-799 -> Reliance Jio
            //            -> 801-920 -> Idea
            //            -> 921-999 -> airtel

            // Setting up phone validity
            isPhoneCheckPassed = false;
            // Storing numbers from inputbox to a variable
            let tempVar = +phone.value;
            // Setting up variable for displaying purposes
            phDisplay = tempVar;
            // Checking if values are only number or not but same can be achived just by putting input type= numbers and 
            //hiding arrows using some css from the intenet
            if (isNaN(tempVar)) {
                return alert("Enter Only Numbers!!");
            }
            // Conditions :- 
            //            -> 621-799 -> Reliance Jio
            //            -> 800-920 -> Idea
            //            -> 921-999 -> airtel
            let currentProvider = null;
            //Step 03(a) :-Extracting first 3 digit numbers from the 10 digit phone number and storing into a variable
            let firstThree = tempVar.toString().slice(0, 3);
            // Checking if first 3 numbers comes under the range of 621-800
            if (firstThree >= 621 && firstThree <= 800) {
                currentProvider = providers.jio;
                image.src = providers.jio.img;
                logoName.innerText = providers.jio.name;
                isPhoneCheckPassed = true;
            }
            // Checking if first 3 numbers comes under the range of 801-920
            if (firstThree >= 801 && firstThree <= 920) {
                currentProvider = providers.vi;
                image.src = providers.vi.img;
                logoName.innerText = providers.vi.name;
                isPhoneCheckPassed = true;
            }
            // Checking if first 3 numbers comes under the range of 921-999
            if (firstThree >= 921 && firstThree <= 999) {
                currentProvider = providers.airtel;
                image.src = providers.airtel.img;
                logoName.innerText = providers.airtel.name;
                isPhoneCheckPassed = true;
            }
            console.log(currentProvider);
            // Step 03 (b):- Check Phone Validation for second 3 digits

            // Extracting second 3 digit numbers from the 10 digit phone number and storing into a variable
            let secondThree = tempVar.toString().slice(3, 6);
            // Array containing all 28 states and 7 UT
            const states = [
                {
                    from: 001,
                    to: 020,
                    stateName: 'Andhra Pradesh'
                },
                {
                    from: 021,
                    to: 040,
                    stateName: 'Arunachal Pradesh'
                },
                {
                    from: 041,
                    to: 060,
                    stateName: 'Assam'
                },
                {
                    from: 061,
                    to: 080,
                    stateName: 'Bihar'
                },
                {
                    from: 081,
                    to: 100,
                    stateName: 'Chhattisgarh'
                },
                {
                    from: 101,
                    to: 120,
                    stateName: 'Goa'
                },
                {
                    from: 121,
                    to: 140,
                    stateName: 'Gujarat'
                },
                {
                    from: 141,
                    to: 160,
                    stateName: 'Haryana'
                },
                {
                    from: 161,
                    to: 180,
                    stateName: 'Himachal Pradesh'
                },
                {
                    from: 181,
                    to: 200,
                    stateName: 'Jharkhand'
                },
                {
                    from: 201,
                    to: 220,
                    stateName: 'Karnataka'
                },
                {
                    from: 221,
                    to: 240,
                    stateName: 'Kerala'
                },
                {
                    from: 241,
                    to: 260,
                    stateName: 'Madhya Pradesh'
                },
                {
                    from: 261,
                    to: 280,
                    stateName: 'Maharashtra'
                },
                {
                    from: 281,
                    to: 300,
                    stateName: 'Manipur'
                },
                {
                    from: 301,
                    to: 320,
                    stateName: 'Meghalaya'
                },
                {
                    from: 321,
                    to: 340,
                    stateName: 'Mizoram'
                },
                {
                    from: 341,
                    to: 360,
                    stateName: 'Nagaland'
                },
                {
                    from: 361,
                    to: 380,
                    stateName: 'Odisha'
                },
                {
                    from: 381,
                    to: 400,
                    stateName: 'Punjab'
                },
                {
                    from: 401,
                    to: 420,
                    stateName: 'Rajasthan'
                },
                {
                    from: 421,
                    to: 440,
                    stateName: 'Sikkim'
                },
                {
                    from: 441,
                    to: 460,
                    stateName: 'Tamil Nadu'
                },
                {
                    from: 461,
                    to: 480,
                    stateName: 'Telangana'
                },
                {
                    from: 481,
                    to: 500,
                    stateName: 'Tripura'
                },
                {
                    from: 501,
                    to: 520,
                    stateName: 'Uttar Pradesh'
                },
                {
                    from: 521,
                    to: 540,
                    stateName: 'Uttarakhand'
                },
                {
                    from: 541,
                    to: 560,
                    stateName: 'West Bengal'
                },
                {
                    from: 561,
                    to: 580,
                    stateName: 'Andaman and Nicobar Islands'
                },
                {
                    from: 581,
                    to: 600,
                    stateName: 'Chandigarh'
                },
                {
                    from: 601,
                    to: 620,
                    stateName: 'Dadra & Nagar Haveli and Daman & Diu'
                },
                {
                    from: 621,
                    to: 640,
                    stateName: 'Delhi'
                },
                {
                    from: 641,
                    to: 660,
                    stateName: 'Jammu and Kashmir'
                },
                {
                    from: 661,
                    to: 680,
                    stateName: 'Lakshadweep'
                },
                {
                    from: 681,
                    to: 700,
                    stateName: 'Puducherry'
                },
                {
                    from: 701,
                    to: 720,
                    stateName: 'Ladakh'
                } - 45
            ];
            let flag = null;
            // Checking secondThree is between ranges or not if it is then print service provider in that range
            for (let currentState of states) {
                if (secondThree >= currentState.from && secondThree <= currentState.to) {
                    flag = currentState.stateName;
                    break;
                }
            }
            document.getElementById('stateName').innerHTML = flag;
        }
        // Step 04:- Generate OTP
        function generateOTP() {

            var digits = '0123456789';
            let OTP = '';
            for (let i = 0; i < 4; i++) {
                OTP += digits[Math.floor(Math.random() * 10)];
            }
            otp.innerText = "OTP of 4 digits: " + OTP;
            // Storing the otp for future validation purposes
            temp = OTP;
            // Automatically Copying the OTP into clipboard
            navigator.clipboard.writeText(OTP);
            // Sending an alert about the otp has been verified
            alert("Copied the text: " + OTP);
        }
        // Step 05:- Verify OTP
        function verifyOtp() {
            let verify = otpVerifyInput.value;
            console.log(verify, temp);
            console.log(verify, temp);
            // Checking if otp is equal to otp that user input
            if (verify == temp) {
                // Successful OTP
                // Clearing Local Storage
                localStorage.clear();
                // Redirecting to pixel6.co
                location.replace("http://pixel6.co/");
            } else {
                // Wrong OTP
                // Setting up otpAttempts (key) and attempts (value) in local storage
                localStorage.setItem("otpAttempts", attempts);

                if (attempts == null) {
                    attempts = 0;
                }
                attempts++;
                // if attempts is less or equal to 3 attempts limit
                if (attempts <= 3) {
                    //Reload the entire page
                    location.reload();
                }
                // Else clear local storage and replace current page with page 404
                else {
                    localStorage.clear();
                    location.replace('http://pixel6.co/404');
                }
            }
        }
        // references of buttons
        let btn2 = document.getElementById('verifyBtn').addEventListener("click", verifyOtp);
        let btn1 = document.getElementById("submit").addEventListener("click", () => {
            // Calling functions as soon as submit button has been clicked
            validateEmail();
            validateName();
            validatePhone();
            // Checking if all the checks are 'true'
            if (isEmailCheckPassed && isNameCheckedPassed && isPhoneCheckPassed) {
                // Call generateOTP when all the verifications are passed
                generateOTP();
                // Hiding first page
                document.getElementById('firstPage').style.display = 'none';
                //Displaying second page
                document.getElementById('secondPage').style.display = 'block';
                // Dsiplaying name and phone number on Successful otp sent dialogue
                document.getElementById('nameDisplay').innerText = nameDisplay;
                document.getElementById('phDisplay').innerText = phDisplay;

            }
        });
        // Code Ends Here :D
    </script>
</body>

</html>